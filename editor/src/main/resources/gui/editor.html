<!DOCTYPE html>
<html>
    <head>
        <style id="style"></style>
        <script>
            document.addEventListener("keypress",
                function(e)
                {
                    if(e.charCode == 13)
                    {
                        e.stopPropagation();
                        e.preventDefault();

                        selection = window.getSelection();

                        range = selection.getRangeAt(0);
                        range.deleteContents();
                        br = document.createElement("br");
                        range.insertNode(br);
                        range.selectNode(br);

                        var real_next = br.nextSibling;
                        while(real_next != null && real_next.nodeType == 3 && real_next.textContent.trim().length == 0)
                            real_next = real_next.nextSibling;

                        var par = br.parentNode;

                        /* Properly represent empty lines at the end of the input. */
                        if(real_next == null && par.nodeName.toLowerCase() == "body")
                        {
                            br = document.createElement("br");
                            range.insertNode(br);
                            range.selectNode(br);
                        }

                        selection.removeAllRanges();
                        selection.addRange(range);
                        selection.collapseToEnd();
                    }
                }
            );

            document.addEventListener("input",
                function(e)
                {
                    var propList = "";
                    for(var propName in e) {
                        if(typeof(e[propName]) != "undefined") {
                            propList += (propName + ", ");
                        }
                    }
                    java.debug(propList);

                    java.debug(e.target);
                }
            );
        </script>
    </head>

    <body contenteditable="true"></body>
</head>
